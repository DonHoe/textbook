import{_ as s,o as a,c as n,S as l}from"./chunks/framework.e9d044e1.js";const F=JSON.parse('{"title":"postgresql","description":"","frontmatter":{},"headers":[],"relativePath":"chapter/database/postgresql.md","filePath":"chapter/database/postgresql.md"}'),p={name:"chapter/database/postgresql.md"},o=l(`<h1 id="postgresql" tabindex="-1">postgresql <a class="header-anchor" href="#postgresql" aria-label="Permalink to &quot;postgresql&quot;">​</a></h1><h2 id="基础知识" tabindex="-1">基础知识 <a class="header-anchor" href="#基础知识" aria-label="Permalink to &quot;基础知识&quot;">​</a></h2><ol><li>函数</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 字符串合并 string || string</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Post</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">greSQL</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">; </span><span style="color:#676E95;font-style:italic;">-- PostgreSQL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 替换字符串 overlay(string placing string from int [for int])</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> overlay(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Txxxxas</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> placing </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> for </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">); </span><span style="color:#676E95;font-style:italic;">-- Thomas</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 指定分隔符合并字符串</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> concat_ws(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abcde</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">22</span><span style="color:#A6ACCD;">); </span><span style="color:#676E95;font-style:italic;">-- abcde,2,22</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 判断时间是否重叠 </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- (start1, end1) OVERLAPS (start2, end2) </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- (start1, length1) OVERLAPS (start2, length2)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">DATE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2001-02-16</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">DATE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2001-12-21</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) OVERLAPS</span></span>
<span class="line"><span style="color:#A6ACCD;">       (</span><span style="color:#C792EA;">DATE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2001-10-30</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">DATE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2002-10-30</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);   </span><span style="color:#676E95;font-style:italic;">-- true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 手动释放空间</span></span>
<span class="line"><span style="color:#A6ACCD;">VACUUM FULL </span><span style="color:#F78C6C;">VERBOSE</span><span style="color:#A6ACCD;"> ANALYZE;</span></span></code></pre></div><ol start="2"><li>类型转换</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">type &#39;string&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">&#39;string&#39;::type</span></span>
<span class="line"><span style="color:#A6ACCD;">CAST ( &#39;string&#39; AS type )</span></span></code></pre></div><ol start="3"><li><code>with</code>关键字，公共表表达式（Common Table Expression，CTE），用于创建可重复使用的临时表。</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#A6ACCD;"> expression_name [ (column_name [, ...] ) ] </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    query</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ...</span></span></code></pre></div><h2 id="窗口函数" tabindex="-1">窗口函数 <a class="header-anchor" href="#窗口函数" aria-label="Permalink to &quot;窗口函数&quot;">​</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 聚合函数(sum avg min max) 专用函数(rank dense_rank row_number)</span></span>
<span class="line"><span style="color:#A6ACCD;">function_name </span><span style="color:#F78C6C;">OVER</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">PARTITION</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">BY</span><span style="color:#A6ACCD;"> column_name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> column_name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 示例</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> depname, empno, salary, ayg(salary) </span><span style="color:#F78C6C;">OVER</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">PARTITION</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">BY</span><span style="color:#A6ACCD;"> depname) </span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> empsalary;</span></span></code></pre></div><h2 id="opengauss常用运维命令" tabindex="-1">openGauss常用运维命令 <a class="header-anchor" href="#opengauss常用运维命令" aria-label="Permalink to &quot;openGauss常用运维命令&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 以操作系统用户omm登录</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看数据库状态 cluster_state显示Normal表示正常</span></span>
<span class="line"><span style="color:#FFCB6B;">gs_om</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 重启数据库</span></span>
<span class="line"><span style="color:#FFCB6B;">gs_om</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 登录数据库</span></span>
<span class="line"><span style="color:#FFCB6B;">gsql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">postgres</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15400</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 兼容的数据库的类型，默认A</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 取值范围：A、B、C、PG，分别表示兼容O、MY、TD和POSTGRES</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- A兼容性下，数据库将空字符串作为NULL处理，数据类型DATE会被替换为TIMESTAMP(0) WITHOUT TIME ZONE。</span></span>
<span class="line"><span style="color:#A6ACCD;">SHOW SQL_COMPATIBILITY;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 只能在创建数据库的时候指定</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">db_name</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WITH</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">ENCODING</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">UTF8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> LC_COLLATE </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">C</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> LC_CTYPE </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">C</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> DBCOMPATIBILITY  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PG</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 修改密码</span></span>
<span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">USER</span><span style="color:#A6ACCD;"> user_name IDENTIFIED </span><span style="color:#F78C6C;">BY</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">new_password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">REPLACE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">old_password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div>`,13),e=[o];function t(c,r,C,y,D,A){return a(),n("div",null,e)}const E=s(p,[["render",t]]);export{F as __pageData,E as default};
