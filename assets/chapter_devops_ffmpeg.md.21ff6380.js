import{_ as s,o as a,c as n,S as l}from"./chunks/framework.e9d044e1.js";const h=JSON.parse('{"title":"ffmpeg","description":"","frontmatter":{},"headers":[],"relativePath":"chapter/devops/ffmpeg.md","filePath":"chapter/devops/ffmpeg.md"}'),p={name:"chapter/devops/ffmpeg.md"},o=l(`<h1 id="ffmpeg" tabindex="-1">ffmpeg <a class="header-anchor" href="#ffmpeg" aria-label="Permalink to &quot;ffmpeg&quot;">​</a></h1><h2 id="用法" tabindex="-1">用法 <a class="header-anchor" href="#用法" aria-label="Permalink to &quot;用法&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> [options] </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">infile options] -i infile]... {</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">outfile options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> outfile}...   </span></span>
<span class="line"><span style="color:#A6ACCD;">ffmpeg </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">选项</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">输入文件选项</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> -i 输入文件</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">... {</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">输出文件选项</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> 输出文件}...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置视频/音频编码器 copy表示复制 例子 设置视频H.264编码 设置音频acc编码</span></span>
<span class="line"><span style="color:#89DDFF;">-c</span><span style="color:#A6ACCD;">:v libx264 </span><span style="color:#89DDFF;">-c</span><span style="color:#A6ACCD;">:a aac </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置视频码率/音频比特率 例子 视频1000kbps 设置音频128kbps </span></span>
<span class="line"><span style="color:#89DDFF;">-b</span><span style="color:#A6ACCD;">:v </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;">k  </span><span style="color:#89DDFF;">-b</span><span style="color:#A6ACCD;">:a </span><span style="color:#F78C6C;">128</span><span style="color:#A6ACCD;">k </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置分辨率 -s 宽度x高度</span></span>
<span class="line"><span style="color:#89DDFF;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1280</span><span style="color:#A6ACCD;">x720</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定帧率为30</span></span>
<span class="line"><span style="color:#89DDFF;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 视频质量 值越小 文件越大</span></span>
<span class="line"><span style="color:#A6ACCD;">-crf </span><span style="color:#F78C6C;">28</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定视频滤镜的选项 </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -vf filter1=value1:param1=value2,filter2=value3:param2=value4</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 裁剪:crop=640:480:10:10 值为 &#39;宽:高:x:y&#39; iw画面宽度  ih画面高度</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 缩放:scale=1280:720</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 模糊:boxblur 锐化:unsharp 左右翻转:hflip </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 旋转:transpose=1 //90度</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 调整亮度(brightness)和对比度(contrast)的滤镜</span></span>
<span class="line"><span style="color:#A6ACCD;">-vf brightness</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0.5</span><span style="color:#A6ACCD;">:contrast</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1.2</span><span style="color:#A6ACCD;"> output.mp4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 隐藏版本和版权信息</span></span>
<span class="line"><span style="color:#A6ACCD;">-hide_banner</span></span></code></pre></div><h2 id="截取视频" tabindex="-1">截取视频 <a class="header-anchor" href="#截取视频" aria-label="Permalink to &quot;截取视频&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">input.mp4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-ss</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">00</span><span style="color:#C3E88D;">:10:00</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">00</span><span style="color:#C3E88D;">:01:00</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libx264</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">output.mp4</span></span></code></pre></div><h2 id="mp4转m3u8" tabindex="-1">mp4转m3u8 <a class="header-anchor" href="#mp4转m3u8" aria-label="Permalink to &quot;mp4转m3u8&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># hls_time 切片时长,hls_list_size 切片数量 0为无限制,hls_segment_filename 切片名称 -hls_base_url 可选，指定ts文件的路径前缀</span></span>
<span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">input.mp4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libx264</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aac</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hls_time</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hls_list_size</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hls_segment_filename</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">output_%03d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">output.m3u8</span></span></code></pre></div><h2 id="压缩视频" tabindex="-1">压缩视频 <a class="header-anchor" href="#压缩视频" aria-label="Permalink to &quot;压缩视频&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># -c:v -c:a 分别指定视频/音频编码 也可以使用copy不重新编码</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -crf 指定压缩质量，数值越小，压缩后的视频质量越高，但文件大小也越大。一般建议使用 18-28 的范围</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -preset 指定压缩速度，可选值包括 veryfast、faster、fast、medium、slow、slower、veryslow建议使用 medium 或 slow。</span></span>
<span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">input.mp4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libx264</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c:a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aac</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-crf</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">23</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-preset</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">medium</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">output.mp4</span></span></code></pre></div><h2 id="加水印" tabindex="-1">加水印 <a class="header-anchor" href="#加水印" aria-label="Permalink to &quot;加水印&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">-vf &quot;drawtext=text=&#39;水印&#39;:fontsize=24:x=(w-text_w-10):y=(h-text_h-10):fontcolor=white:box=1:boxcolor=black@0.5:fontfile=/path/to/font.ttf&quot;</span></span></code></pre></div><h2 id="直播推流" tabindex="-1">直播推流 <a class="header-anchor" href="#直播推流" aria-label="Permalink to &quot;直播推流&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ffmpeg -re -i &#39;input.mp4&#39; -vcodec libx264 -acodec aac -f flv  rtmp://127.0.0.1:1938/live/test</span></span></code></pre></div><h2 id="硬件加速" tabindex="-1">硬件加速 <a class="header-anchor" href="#硬件加速" aria-label="Permalink to &quot;硬件加速&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看支持的加速模式</span></span>
<span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hwaccels</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 启用加速，nv显卡</span></span>
<span class="line"><span style="color:#FFCB6B;">ffmpeg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hwaccel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cuda</span></span></code></pre></div>`,15),e=[o];function t(c,r,i,C,y,D){return a(),n("div",null,e)}const f=s(p,[["render",t]]);export{h as __pageData,f as default};
